```python
# è‡ªåŠ¨è®¡ç®—cellçš„è®¡ç®—æ—¶é—´
%load_ext autotime

%matplotlib inline
%config InlineBackend.figure_format='svg' #çŸ¢é‡å›¾è®¾ç½®ï¼Œè®©ç»˜å›¾æ›´æ¸…æ™°
```

# 4-1,å¼ é‡çš„ç»“æ„æ“ä½œ

å¼ é‡çš„æ“ä½œä¸»è¦åŒ…æ‹¬å¼ é‡çš„ç»“æ„æ“ä½œå’Œå¼ é‡çš„æ•°å­¦è¿ç®—ã€‚

å¼ é‡ç»“æ„æ“ä½œè¯¸å¦‚ï¼šå¼ é‡åˆ›å»ºï¼Œç´¢å¼•åˆ‡ç‰‡ï¼Œç»´åº¦å˜æ¢ï¼Œåˆå¹¶åˆ†å‰²ã€‚

å¼ é‡æ•°å­¦è¿ç®—ä¸»è¦æœ‰ï¼šæ ‡é‡è¿ç®—ï¼Œå‘é‡è¿ç®—ï¼ŒçŸ©é˜µè¿ç®—ã€‚å¦å¤–æˆ‘ä»¬ä¼šä»‹ç»å¼ é‡è¿ç®—çš„å¹¿æ’­æœºåˆ¶ã€‚

æœ¬ç¯‡æˆ‘ä»¬ä»‹ç»å¼ é‡çš„ç»“æ„æ“ä½œã€‚


### ä¸€ï¼Œåˆ›å»ºå¼ é‡


å¼ é‡åˆ›å»ºçš„è®¸å¤šæ–¹æ³•å’Œnumpyä¸­åˆ›å»ºarrayçš„æ–¹æ³•å¾ˆåƒã€‚

```python
import numpy as np
import torch 
```

```python
a = torch.tensor([1,2,3],dtype = torch.float)
print(a)
```

```python
b = torch.arange(1,10,step = 2)
print(b)
```

```python
c = torch.linspace(0.0,2*3.14,10)
print(c)
```

```python
d = torch.zeros((3,3))
print(d)
```

```python
a = torch.ones((3,3),dtype = torch.int)
b = torch.zeros_like(a,dtype = torch.float)
print(a)
print(b)
```

```python
torch.fill_(b,5)
print(b)
```

```python
#å‡åŒ€éšæœºåˆ†å¸ƒ
torch.manual_seed(0)
minval,maxval = 0,10
a = minval + (maxval-minval)*torch.rand([5])
print(a)
```

```python
#æ­£æ€åˆ†å¸ƒéšæœº
b = torch.normal(mean = torch.zeros(3,3), std = torch.ones(3,3))
print(b)
```

```python
#æ­£æ€åˆ†å¸ƒéšæœº
mean,std = 2,5
c = std*torch.randn((3,3))+mean
print(c)
```

```python
#æ•´æ•°éšæœºæ’åˆ—
d = torch.randperm(20)
print(d)
```

```python
#ç‰¹æ®ŠçŸ©é˜µ
I = torch.eye(3,3) #å•ä½çŸ©é˜µ
print(I)
t = torch.diag(torch.tensor([1,2,3])) #å¯¹è§’çŸ©é˜µ
print(t)
```

### äºŒ ï¼Œç´¢å¼•åˆ‡ç‰‡


å¼ é‡çš„ç´¢å¼•åˆ‡ç‰‡æ–¹å¼å’Œnumpyå‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚åˆ‡ç‰‡æ—¶æ”¯æŒç¼ºçœå‚æ•°å’Œçœç•¥å·ã€‚

å¯ä»¥é€šè¿‡ç´¢å¼•å’Œåˆ‡ç‰‡å¯¹éƒ¨åˆ†å…ƒç´ è¿›è¡Œä¿®æ”¹ã€‚

æ­¤å¤–ï¼Œå¯¹äºä¸è§„åˆ™çš„åˆ‡ç‰‡æå–,å¯ä»¥ä½¿ç”¨torch.index_select, torch.masked_select, torch.take

å¦‚æœè¦é€šè¿‡ä¿®æ”¹å¼ é‡çš„æŸäº›å…ƒç´ å¾—åˆ°æ–°çš„å¼ é‡ï¼Œå¯ä»¥ä½¿ç”¨torch.where,torch.masked_fill,torch.index_fill

```python
#å‡åŒ€éšæœºåˆ†å¸ƒ
torch.manual_seed(0)
minval,maxval = 0,10
t = torch.floor(minval + (maxval-minval)*torch.rand([5,5])).int()
print(t)
```

```python
#ç¬¬0è¡Œ
print(t[0])
```

```python
#å€’æ•°ç¬¬ä¸€è¡Œ
print(t[-1])
```

```python
#ç¬¬1è¡Œç¬¬3åˆ—
print(t[1,3])
print(t[1][3])
```

```python
#ç¬¬1è¡Œè‡³ç¬¬3è¡Œ
print(t[1:4,:])
```

```python
#ç¬¬1è¡Œè‡³æœ€åä¸€è¡Œï¼Œç¬¬0åˆ—åˆ°æœ€åä¸€åˆ—æ¯éš”ä¸¤åˆ—å–ä¸€åˆ—
print(t[1:4,:4:2])
```

```python
#å¯ä»¥ä½¿ç”¨ç´¢å¼•å’Œåˆ‡ç‰‡ä¿®æ”¹éƒ¨åˆ†å…ƒç´ 
x = torch.tensor([[1,2],[3,4]],dtype = torch.float32,requires_grad=True)
x.data[1,:] = torch.tensor([0.0,0.0])
x
```

```python
a = torch.arange(27).view(3,3,3)
print(a)
```

```python
#çœç•¥å·å¯ä»¥è¡¨ç¤ºå¤šä¸ªå†’å·
print(a[...,1])
```

ä»¥ä¸Šåˆ‡ç‰‡æ–¹å¼ç›¸å¯¹è§„åˆ™ï¼Œå¯¹äºä¸è§„åˆ™çš„åˆ‡ç‰‡æå–,å¯ä»¥ä½¿ç”¨torch.index_select, torch.take, torch.gather, torch.masked_select.

è€ƒè™‘ç­çº§æˆç»©å†Œçš„ä¾‹å­ï¼Œæœ‰4ä¸ªç­çº§ï¼Œæ¯ä¸ªç­çº§10ä¸ªå­¦ç”Ÿï¼Œæ¯ä¸ªå­¦ç”Ÿ7é—¨ç§‘ç›®æˆç»©ã€‚å¯ä»¥ç”¨ä¸€ä¸ª4Ã—10Ã—7çš„å¼ é‡æ¥è¡¨ç¤ºã€‚


```python
minval=0
maxval=100
scores = torch.floor(minval + (maxval-minval)*torch.rand([4,10,7])).int()
print(scores)
```

```python
scores.index_select(dim=1, index=torch.tensor([0,5,9]))
```

```python
#æŠ½å–æ¯ä¸ªç­çº§ç¬¬0ä¸ªå­¦ç”Ÿï¼Œç¬¬5ä¸ªå­¦ç”Ÿï¼Œç¬¬9ä¸ªå­¦ç”Ÿçš„å…¨éƒ¨æˆç»©
torch.index_select(scores,dim = 1,index = torch.tensor([0,5,9]))
```

```python
#æŠ½å–æ¯ä¸ªç­çº§ç¬¬0ä¸ªå­¦ç”Ÿï¼Œç¬¬5ä¸ªå­¦ç”Ÿï¼Œç¬¬9ä¸ªå­¦ç”Ÿçš„ç¬¬1é—¨è¯¾ç¨‹ï¼Œç¬¬3é—¨è¯¾ç¨‹ï¼Œç¬¬6é—¨è¯¾ç¨‹æˆç»©
q = torch.index_select(torch.index_select(scores,dim = 1,index = torch.tensor([0,5,9]))
                   ,dim=2,index = torch.tensor([1,3,6]))
print(q)
```

```python
#æŠ½å–ç¬¬0ä¸ªç­çº§ç¬¬0ä¸ªå­¦ç”Ÿçš„ç¬¬0é—¨è¯¾ç¨‹ï¼Œç¬¬2ä¸ªç­çº§çš„ç¬¬4ä¸ªå­¦ç”Ÿçš„ç¬¬1é—¨è¯¾ç¨‹ï¼Œç¬¬3ä¸ªç­çº§çš„ç¬¬9ä¸ªå­¦ç”Ÿç¬¬6é—¨è¯¾ç¨‹æˆç»©
#takeå°†è¾“å…¥çœ‹æˆä¸€ç»´æ•°ç»„ï¼Œè¾“å‡ºå’ŒindexåŒå½¢çŠ¶
s = torch.take(scores,torch.tensor([0*10*7+0,2*10*7+4*7+1,3*10*7+9*7+6]))
s
```

```python
#æŠ½å–åˆ†æ•°å¤§äºç­‰äº80åˆ†çš„åˆ†æ•°ï¼ˆå¸ƒå°”ç´¢å¼•ï¼‰
#ç»“æœæ˜¯1ç»´å¼ é‡
g = torch.masked_select(scores,scores>=80)
print(g)
```

```python
scores[scores >=80]
```

ä»¥ä¸Šè¿™äº›æ–¹æ³•ä»…èƒ½æå–å¼ é‡çš„éƒ¨åˆ†å…ƒç´ å€¼ï¼Œä½†ä¸èƒ½æ›´æ”¹å¼ é‡çš„éƒ¨åˆ†å…ƒç´ å€¼å¾—åˆ°æ–°çš„å¼ é‡ã€‚

å¦‚æœè¦é€šè¿‡ä¿®æ”¹å¼ é‡çš„éƒ¨åˆ†å…ƒç´ å€¼å¾—åˆ°æ–°çš„å¼ é‡ï¼Œå¯ä»¥ä½¿ç”¨torch.where,torch.index_fill å’Œ torch.masked_fill

torch.whereå¯ä»¥ç†è§£ä¸ºifçš„å¼ é‡ç‰ˆæœ¬ã€‚

torch.index_fillçš„é€‰å–å…ƒç´ é€»è¾‘å’Œtorch.index_selectç›¸åŒã€‚

torch.masked_fillçš„é€‰å–å…ƒç´ é€»è¾‘å’Œtorch.masked_selectç›¸åŒã€‚


```python
#å¦‚æœåˆ†æ•°å¤§äº60åˆ†ï¼Œèµ‹å€¼æˆ1ï¼Œå¦åˆ™èµ‹å€¼æˆ0
ifpass = torch.where(scores>60,torch.tensor(1),torch.tensor(0))
print(ifpass)
```

```python
#å°†æ¯ä¸ªç­çº§ç¬¬0ä¸ªå­¦ç”Ÿï¼Œç¬¬5ä¸ªå­¦ç”Ÿï¼Œç¬¬9ä¸ªå­¦ç”Ÿçš„å…¨éƒ¨æˆç»©èµ‹å€¼æˆæ»¡åˆ†
torch.index_fill(scores,dim = 1,index = torch.tensor([0,5,9]),value = 100)
#ç­‰ä»·äº scores.index_fill(dim = 1,index = torch.tensor([0,5,9]),value = 100)
```

```python
#å°†åˆ†æ•°å°äº60åˆ†çš„åˆ†æ•°èµ‹å€¼æˆ60åˆ†
b = torch.masked_fill(scores,scores<60,60)
#ç­‰ä»·äºb = scores.masked_fill(scores<60,60)
b
```

### ä¸‰ï¼Œç»´åº¦å˜æ¢


ç»´åº¦å˜æ¢ç›¸å…³å‡½æ•°ä¸»è¦æœ‰ torch.reshape(æˆ–è€…è°ƒç”¨å¼ é‡çš„viewæ–¹æ³•), torch.squeeze, torch.unsqueeze, torch.transpose

torch.reshape å¯ä»¥æ”¹å˜å¼ é‡çš„å½¢çŠ¶ã€‚

torch.squeeze å¯ä»¥å‡å°‘ç»´åº¦ã€‚

torch.unsqueeze å¯ä»¥å¢åŠ ç»´åº¦ã€‚

torch.transpose å¯ä»¥äº¤æ¢ç»´åº¦ã€‚


```python
# å¼ é‡çš„viewæ–¹æ³•æœ‰æ—¶å€™ä¼šè°ƒç”¨å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨reshapeæ–¹æ³•ã€‚

torch.manual_seed(0)
minval,maxval = 0,255
a = (minval + (maxval-minval)*torch.rand([1,3,3,2])).int()
print(a.shape)
print(a)
```

```python
# æ”¹æˆ ï¼ˆ3,6ï¼‰å½¢çŠ¶çš„å¼ é‡
b = a.view([3,6]) #torch.reshape(a,[3,6])
print(b.shape)
print(b)
```

```python
# æ”¹å›æˆ [1,3,3,2] å½¢çŠ¶çš„å¼ é‡
c = torch.reshape(b,[1,3,3,2]) # b.view([1,3,3,2]) 
print(c)
```

å¦‚æœå¼ é‡åœ¨æŸä¸ªç»´åº¦ä¸Šåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ©ç”¨torch.squeezeå¯ä»¥æ¶ˆé™¤è¿™ä¸ªç»´åº¦ã€‚

torch.unsqueezeçš„ä½œç”¨å’Œtorch.squeezeçš„ä½œç”¨ç›¸åã€‚

```python
a = torch.tensor([[1.0,2.0]])
s = torch.squeeze(a)
print(a)
print(s)
print(a.shape)
print(s.shape)
```

```python
#åœ¨ç¬¬0ç»´æ’å…¥é•¿åº¦ä¸º1çš„ä¸€ä¸ªç»´åº¦

d = torch.unsqueeze(s,axis=0)  
print(s)
print(d)

print(s.shape)
print(d.shape)
```

torch.transposeå¯ä»¥äº¤æ¢å¼ é‡çš„ç»´åº¦ï¼Œtorch.transposeå¸¸ç”¨äºå›¾ç‰‡å­˜å‚¨æ ¼å¼çš„å˜æ¢ä¸Šã€‚

å¦‚æœæ˜¯äºŒç»´çš„çŸ©é˜µï¼Œé€šå¸¸ä¼šè°ƒç”¨çŸ©é˜µçš„è½¬ç½®æ–¹æ³• matrix.t()ï¼Œç­‰ä»·äº torch.transpose(matrix,0,1)ã€‚


```python
minval=0
maxval=255
# Batch,Height,Width,Channel
data = torch.floor(minval + (maxval-minval)*torch.rand([100,256,256,4])).int()
print(data.shape)

# è½¬æ¢æˆ Pytorché»˜è®¤çš„å›¾ç‰‡æ ¼å¼ Batch,Channel,Height,Width 
# éœ€è¦äº¤æ¢ä¸¤æ¬¡
data_t = torch.transpose(torch.transpose(data,1,2),1,3)
print(data_t.shape)
```

```python
torch.einsum('ijkl -> i ljk',data).shape
```

```python
matrix = torch.tensor([[1,2,3],[4,5,6]])
print(matrix)
print(matrix.t()) #ç­‰ä»·äºtorch.transpose(matrix,0,1)
```

```python
matrix.T
```

### å››ï¼Œåˆå¹¶åˆ†å‰²


å¯ä»¥ç”¨torch.catæ–¹æ³•å’Œtorch.stackæ–¹æ³•å°†å¤šä¸ªå¼ é‡åˆå¹¶ï¼Œå¯ä»¥ç”¨torch.splitæ–¹æ³•æŠŠä¸€ä¸ªå¼ é‡åˆ†å‰²æˆå¤šä¸ªå¼ é‡ã€‚

torch.catå’Œtorch.stackæœ‰ç•¥å¾®çš„åŒºåˆ«ï¼Œtorch.catæ˜¯è¿æ¥ï¼Œä¸ä¼šå¢åŠ ç»´åº¦ï¼Œè€Œtorch.stackæ˜¯å †å ï¼Œä¼šå¢åŠ ç»´åº¦ã€‚


```python
a = torch.tensor([[1.0,2.0],[3.0,4.0]])
b = torch.tensor([[5.0,6.0],[7.0,8.0]])
c = torch.tensor([[9.0,10.0],[11.0,12.0]])

abc_cat = torch.cat([a,b,c],dim = 0)
print(abc_cat.shape)
print(abc_cat)
```

```python
abc_stack = torch.stack([a,b,c],axis = 0) #torchä¸­dimå’Œaxiså‚æ•°åå¯ä»¥æ··ç”¨
print(abc_stack.shape)
print(abc_stack)
```

```python
torch.cat([a,b,c],axis = 1)
```

```python
torch.stack([a,b,c],axis = 1)
```

torch.splitæ˜¯torch.catçš„é€†è¿ç®—ï¼Œå¯ä»¥æŒ‡å®šåˆ†å‰²ä»½æ•°å¹³å‡åˆ†å‰²ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šæ¯ä»½çš„è®°å½•æ•°é‡è¿›è¡Œåˆ†å‰²ã€‚

```python
print(abc_cat)
a,b,c = torch.split(abc_cat,split_size_or_sections = 2,dim = 0) #æ¯ä»½2ä¸ªè¿›è¡Œåˆ†å‰²
print(a)
print(b)
print(c)
```

```python
abc_cat.split(2)
```

```python
abc_cat.split_with_sizes([1,3,2])
```

```python
print(abc_cat)
p,q,r = torch.split(abc_cat,split_size_or_sections =[4,1,1],dim = 0) #æ¯ä»½åˆ†åˆ«ä¸º[4,1,1]
print(p)
print(q)
print(r)
```

**å¦‚æœæœ¬ä¹¦å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæƒ³é¼“åŠ±ä¸€ä¸‹ä½œè€…ï¼Œè®°å¾—ç»™æœ¬é¡¹ç›®åŠ ä¸€é¢—æ˜Ÿæ˜Ÿstarâ­ï¸ï¼Œå¹¶åˆ†äº«ç»™ä½ çš„æœ‹å‹ä»¬å–”ğŸ˜Š!** 

å¦‚æœå¯¹æœ¬ä¹¦å†…å®¹ç†è§£ä¸Šæœ‰éœ€è¦è¿›ä¸€æ­¥å’Œä½œè€…äº¤æµçš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨å…¬ä¼—å·"ç®—æ³•ç¾é£Ÿå±‹"ä¸‹ç•™è¨€ã€‚ä½œè€…æ—¶é—´å’Œç²¾åŠ›æœ‰é™ï¼Œä¼šé…Œæƒ…äºˆä»¥å›å¤ã€‚

ä¹Ÿå¯ä»¥åœ¨å…¬ä¼—å·åå°å›å¤å…³é”®å­—ï¼š**åŠ ç¾¤**ï¼ŒåŠ å…¥è¯»è€…äº¤æµç¾¤å’Œå¤§å®¶è®¨è®ºã€‚

![ç®—æ³•ç¾é£Ÿå±‹logo.png](./data/ç®—æ³•ç¾é£Ÿå±‹äºŒç»´ç .jpg)
